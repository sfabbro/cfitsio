--- fitsio.h.orig	2013-12-06 10:44:34.000000000 -0800
+++ fitsio.h	2014-01-10 15:59:50.975120059 -0800
@@ -69,7 +69,7 @@
 #  define _MIPS_SZLONG 64
 #endif
 
-#if defined(linux) || defined(__APPLE__) || defined(__sgi)
+#if defined(__linux__) || defined(__APPLE__) || defined(__sgi)
 #  include <sys/types.h>  /* apparently needed on debian linux systems */
 #endif                    /* to define off_t                           */
 
@@ -86,7 +86,7 @@
 /*  Debian systems require: "(defined(linux) && defined(__off_t_defined))" */
 /*  the mingw-w64 compiler requires: "(defined(__MINGW32__) && defined(_OFF_T_DEFINED))" */
 #if defined(_OFF_T) \
-    || (defined(linux) && defined(__off_t_defined)) \
+    || (defined(__linux__) && defined(__off_t_defined)) \
     || (defined(__MINGW32__) && defined(_OFF_T_DEFINED)) \
     || defined(_MIPS_SZLONG) || defined(__APPLE__) || defined(_AIX)
 #    define OFF_T off_t
--- cfileio.c.orig	2013-06-27 21:46:22.486710330 -0700
+++ cfileio.c	2013-06-27 21:46:45.623841289 -0700
@@ -86,7 +86,7 @@
         return(status);
     }
 
-#ifdef linux
+#ifdef __GLIBC__
     status = pthread_mutexattr_settype(&mutex_init,
 				     PTHREAD_MUTEX_RECURSIVE_NP);
 #else
