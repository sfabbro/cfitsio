--- fitsio.h.orig	2013-06-10 12:05:34.000000000 -0700
+++ fitsio.h	2013-06-27 21:46:22.484710317 -0700
@@ -54,7 +54,7 @@
 #  define _MIPS_SZLONG 64
 #endif
 
-#if defined(linux) || defined(__APPLE__) || defined(__sgi)
+#if defined(__linux__) || defined(__APPLE__) || defined(__sgi)
 #  include <sys/types.h>  /* apparently needed on debian linux systems */
 #endif                    /* to define off_t                           */
 
@@ -70,7 +70,7 @@
 
 /*  Debian systems require the 2nd test, below,         */
 /*  i.e, "(defined(linux) && defined(__off_t_defined))" */
-#if defined(_OFF_T) || (defined(linux) && defined(__off_t_defined)) || defined(_MIPS_SZLONG) || defined(__APPLE__) || defined(_AIX)
+#if defined(_OFF_T) || (defined(__linux__) && defined(__off_t_defined)) || defined(_MIPS_SZLONG) || defined(__APPLE__) || defined(_AIX)
 #    define OFF_T off_t
 #elif defined(_MSC_VER) &&  (_MSC_VER>= 1400)
 #    define OFF_T long long
--- cfileio.c.orig	2013-06-27 21:46:22.486710330 -0700
+++ cfileio.c	2013-06-27 21:46:45.623841289 -0700
@@ -86,7 +86,7 @@
         return(status);
     }
 
-#ifdef linux
+#ifdef __GLIBC__
     status = pthread_mutexattr_settype(&mutex_init,
 				     PTHREAD_MUTEX_RECURSIVE_NP);
 #else
